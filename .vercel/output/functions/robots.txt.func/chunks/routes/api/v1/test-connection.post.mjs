import{d as e,a as o}from"../../../_/nitro.mjs";import{OpenAI as t}from"openai";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:url";import"ipx";import"node:fs";import"node:path";import"node:crypto";const s=e(async e=>{var s;try{const r=await o(e),{apiKey:n,baseURL:a,model:i,type:m,provider:p}=r;if(!n)throw new Error("缺少API密钥");if("base"===m){const e=new t({apiKey:n,baseURL:a||void 0});return{success:!0,message:"基础模型连接测试成功",model:(await e.chat.completions.create({model:i||"gpt-3.5-turbo",messages:[{role:"system",content:"你是一个有用的助手。"},{role:"user",content:'请回复"连接测试成功"'}],max_tokens:20})).model}}if("image"===m){let e="",o={"Content-Type":"application/json"},t={};"moonshot"===p?(e=`${a||"https://api.moonshot.cn/v1"}/chat/completions`,o.Authorization=`Bearer ${n}`,t={model:i||"moonshot-v1-8k",messages:[{role:"user",content:'请回复"图像识别模型连接测试成功"'}],max_tokens:20}):"zhipu"===p?(e=`${a||"https://open.bigmodel.cn/api/paas/v4"}/chat/completions`,o.Authorization=`Bearer ${n}`,t={model:i||"glm-4v",messages:[{role:"user",content:'请回复"图像识别模型连接测试成功"'}],max_tokens:20}):"aliyun"===p?(e=`${a||"https://dashscope.aliyuncs.com/api/v1"}/chat/completions`,o.Authorization=`Bearer ${n}`,t={model:i||"qwen-vl-plus",messages:[{role:"user",content:'请回复"图像识别模型连接测试成功"'}],max_tokens:20}):(e=`${a||"https://api.openai.com/v1"}/chat/completions`,o.Authorization=`Bearer ${n}`,t={model:i||"gpt-4-vision-preview",messages:[{role:"user",content:'请回复"图像识别模型连接测试成功"'}],max_tokens:20});const r=await fetch(e,{method:"POST",headers:o,body:JSON.stringify(t)});if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error((null==(s=e.error)?void 0:s.message)||`请求失败 (${r.status})`)}return{success:!0,message:"图像识别模型连接测试成功",model:(await r.json()).model||i}}throw new Error("未知的测试类型")}catch(e){return console.error("连接测试错误:",e),{success:!1,message:e instanceof Error?e.message:"连接测试失败，请检查API密钥和网络连接"}}});export{s as default};
//# sourceMappingURL=test-connection.post.mjs.map
