import{d as e,a as s}from"../../../_/nitro.mjs";import o from"openai";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:url";import"ipx";import"node:fs";import"node:path";import"node:crypto";const t=[{value:"gpt-4-turbo",label:"GPT-4 Turbo",provider:"openai"},{value:"gpt-4",label:"GPT-4",provider:"openai"},{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo",provider:"openai"},{value:"claude-3-sonnet-20240229",label:"Claude 3 Sonnet",provider:"anthropic"},{value:"claude-3-opus-20240229",label:"Claude 3 Opus",provider:"anthropic"},{value:"moonshot-v1-8k",label:"Moonshot v1",provider:"moonshot"},{value:"moonshot-v1-32k",label:"Moonshot v1-32k",provider:"moonshot"},{value:"glm-4",label:"GLM-4",provider:"zhipu"},{value:"qwen-max",label:"Qwen Max",provider:"aliyun"}],a=[{value:"gpt-4-vision",label:"GPT-4 Vision",provider:"openai"},{value:"moonshot-v1-8k",label:"Moonshot V1",provider:"moonshot"},{value:"moonshot-v1-32k",label:"Moonshot V1-32K",provider:"moonshot"},{value:"glm-4v",label:"GLM-4V",provider:"zhipu"},{value:"qwen-vl-plus",label:"Qwen VL+",provider:"aliyun"}],n=e(async e=>{const o=e.node.req.method;if("GET"===o)return{success:!0,data:{baseModels:t,visionModels:a}};if("POST"===o)try{const o=await s(e),{apiProvider:t,apiKey:a,model:n,baseURL:r}=o;if(!a)return{success:!1,message:"请提供 API 密钥"};const i=Date.now();let c;switch(t){case"openai":default:c=await testOpenAI(a,n,r);break;case"anthropic":c=await async function(e,s="claude-3-sonnet-20240229",o){var t;try{const a=o||"https://api.anthropic.com/v1/messages",n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":e,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:s||"claude-3-sonnet-20240229",max_tokens:10,messages:[{role:"user",content:'请回复"连接成功"'}]})});if(!n.ok){const e=await n.json();throw new Error((null==(t=e.error)?void 0:t.message)||`HTTP 错误 ${n.status}`)}return{success:!0,message:"连接成功！Anthropic API 工作正常。",model:(await n.json()).model}}catch(e){return{success:!1,message:`连接失败: ${e.message}`}}}(a,n,r);break;case"moonshot":c=await async function(e,s="moonshot-v1-8k",o){var t;try{const a=o||"https://api.moonshot.cn/v1/chat/completions",n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:s||"moonshot-v1-8k",messages:[{role:"user",content:'请回复"连接成功"'}],max_tokens:10})});if(!n.ok){const e=await n.json();throw new Error((null==(t=e.error)?void 0:t.message)||`HTTP 错误 ${n.status}`)}return{success:!0,message:"连接成功！Moonshot API 工作正常。",model:(await n.json()).model}}catch(e){return{success:!1,message:`连接失败: ${e.message}`}}}(a,n,r);break;case"zhipu":c=await async function(e,s="glm-4",o){var t;try{const a=o||"https://open.bigmodel.cn/api/paas/v4/chat/completions",n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:s||"glm-4",messages:[{role:"user",content:'请回复"连接成功"'}],max_tokens:10})});if(!n.ok){const e=await n.json();throw new Error((null==(t=e.error)?void 0:t.message)||`HTTP 错误 ${n.status}`)}return{success:!0,message:"连接成功！智谱 AI API 工作正常。",model:(await n.json()).model}}catch(e){return{success:!1,message:`连接失败: ${e.message}`}}}(a,n,r);break;case"aliyun":c=await async function(e,s="qwen-max",o){try{if(!o)return{success:!1,message:"请提供阿里云 API 的 Base URL"};const t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:s||"qwen-max",input:{messages:[{role:"user",content:'请回复"连接成功"'}]},parameters:{max_tokens:10}})});if(!t.ok){const e=await t.json();throw new Error(e.message||`HTTP 错误 ${t.status}`)}await t.json();return{success:!0,message:"连接成功！阿里云 API 工作正常。",model:s}}catch(e){return{success:!1,message:`连接失败: ${e.message}`}}}(a,n,r)}const l=Date.now()-i;return{success:c.success,message:c.message,model:c.model,responseTime:l}}catch(e){return console.error("API 连接测试失败:",e),{success:!1,message:e instanceof Error?e.message:"连接测试失败，请检查 API 密钥和网络连接"}}});async function testOpenAI(e,s="gpt-3.5-turbo",t){try{const a=new o({apiKey:e,baseURL:t||void 0});return{success:!0,message:"连接成功！OpenAI API 工作正常。",model:(await a.chat.completions.create({model:s||"gpt-3.5-turbo",messages:[{role:"user",content:'请回复"连接成功"'}],max_tokens:10})).model}}catch(e){return 401===e.status?{success:!1,message:"API 密钥无效或已过期"}:404===e.status?{success:!1,message:`模型 "${s}" 不存在或您没有访问权限`}:{success:!1,message:`连接失败: ${e.message}`}}}export{n as default};
//# sourceMappingURL=env-check.mjs.map
