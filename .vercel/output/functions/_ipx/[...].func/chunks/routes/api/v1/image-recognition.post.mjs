import{d as o,b as t}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:url";import"ipx";import"node:fs";import"node:path";import"node:crypto";const e=o(async o=>{var e,r,s,n;try{const i=await t(o),{request:a,apiKey:c,baseURL:m}=i;if(!a||!c)throw new Error("缺少必要参数：request 或 apiKey");const{model:p,messages:h}=a;let l="",d={"Content-Type":"application/json"};p.includes("moonshot")?(l=`${m||"https://api.moonshot.cn/v1"}/chat/completions`,d.Authorization=`Bearer ${c}`):p.includes("glm")?(l=`${m||"https://open.bigmodel.cn/api/paas/v4"}/chat/completions`,d.Authorization=`Bearer ${c}`):p.includes("qwen")?(l=`${m}/chat/completions`,d.Authorization=`Bearer ${c}`):(l=`${m||"https://api.openai.com/v1"}/chat/completions`,d.Authorization=`Bearer ${c}`);const u=await fetch(l,{method:"POST",headers:d,body:JSON.stringify({model:p,messages:h,max_tokens:2e3,temperature:.1})});if(!u.ok){const o=await u.json().catch(()=>({}));if(401===u.status)throw new Error("API 密钥无效或已过期");if(429===u.status)throw new Error("API 请求频率限制，请稍后重试");if(u.status>=500)throw new Error("AI 服务暂时不可用，请稍后重试");throw new Error((null==(e=o.error)?void 0:e.message)||`请求失败 (${u.status})`)}const w=await u.json(),f=(null==(n=null==(s=null==(r=w.choices)?void 0:r[0])?void 0:s.message)?void 0:n.content)||"";if(!f)throw new Error("未能从图片中提取到文本内容");return{success:!0,text:f.trim(),model:w.model||p}}catch(o){return console.error("图片识别错误:",o),{success:!1,message:o instanceof Error?o.message:"图片识别失败，请稍后重试"}}});export{e as default};
//# sourceMappingURL=image-recognition.post.mjs.map
