import{d as e,b as s}from"../../../_/nitro.mjs";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:url";import"ipx";import"node:fs";import"node:path";import"node:crypto";const t=e(async e=>{try{const t=await s(e),{apiProvider:o,apiKey:r,model:a}=t;if(!o||!r)return{success:!1,message:"缺少必要参数：API提供商和密钥"};const n=Date.now();let c,i=a||"gpt-3.5-turbo";switch(o){case"openai":c=await async function(e,s){var t;try{const o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:s,messages:[{role:"user",content:'Test connection. Please respond with "OK".'}],max_tokens:5,temperature:0})});if(o.ok){return{success:!0,model:(await o.json()).model||s}}return{success:!1,error:(null==(t=(await o.json().catch(()=>({}))).error)?void 0:t.message)||`HTTP ${o.status}: ${o.statusText}`}}catch(e){return{success:!1,error:`网络错误: ${e instanceof Error?e.message:"未知错误"}`}}}(r,i);break;case"anthropic":c=await async function(e,s){var t;try{const o=s.includes("claude")?s:"claude-3-haiku-20240307",r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":e,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify({model:o,max_tokens:5,messages:[{role:"user",content:'Test connection. Please respond with "OK".'}]})});if(r.ok)return{success:!0,model:o};return{success:!1,error:(null==(t=(await r.json().catch(()=>({}))).error)?void 0:t.message)||`HTTP ${r.status}: ${r.statusText}`}}catch(e){return{success:!1,error:`网络错误: ${e instanceof Error?e.message:"未知错误"}`}}}(r,i);break;case"moonshot":c=await async function(e,s){var t;try{const o=s.includes("moonshot")?s:"moonshot-v1-8k",r=await fetch("https://api.moonshot.cn/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:o,messages:[{role:"user",content:'Test connection. Please respond with "OK".'}],max_tokens:5,temperature:0})});if(r.ok)return{success:!0,model:o};return{success:!1,error:(null==(t=(await r.json().catch(()=>({}))).error)?void 0:t.message)||`HTTP ${r.status}: ${r.statusText}`}}catch(e){return{success:!1,error:`网络错误: ${e instanceof Error?e.message:"未知错误"}`}}}(r,i);break;case"zhipu":c=await async function(e,s){var t;try{const o=s.includes("glm")?s:"glm-4",r=await fetch("https://open.bigmodel.cn/api/paas/v4/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:o,messages:[{role:"user",content:'Test connection. Please respond with "OK".'}],max_tokens:5,temperature:0})});if(r.ok)return{success:!0,model:o};return{success:!1,error:(null==(t=(await r.json().catch(()=>({}))).error)?void 0:t.message)||`HTTP ${r.status}: ${r.statusText}`}}catch(e){return{success:!1,error:`网络错误: ${e instanceof Error?e.message:"未知错误"}`}}}(r,i);break;default:return{success:!1,message:"不支持的API提供商"}}const u=Date.now()-n;return c.success?{success:!0,message:"连接测试成功",model:c.model||i,responseTime:u,provider:o}:{success:!1,message:c.error||"连接测试失败"}}catch(e){return console.error("连通性测试错误:",e),{success:!1,message:"服务器内部错误"}}});export{t as default};
//# sourceMappingURL=test-connection.post.mjs.map
